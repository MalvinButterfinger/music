<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audio things</title>
    <style type="text/css">
        body {
            margin: 40px auto;
            max-width: 650px;
            line-height: 1.6;
            font-size: 18px;
            color: #444;
            padding: 0 10px
        }

        h1, h2, h3 {
            line-height: 1.2
        }

        .hljs {
            display: block;
            overflow-x: auto;
            padding: 0.5em;
            background: #fdf6e3;
            color: #657b83;
        }

        .hljs-comment,
        .hljs-quote {
            color: #93a1a1;
        }

        /* Solarized Green */
        .hljs-keyword,
        .hljs-selector-tag,
        .hljs-addition {
            color: #859900;
        }

        /* Solarized Cyan */
        .hljs-number,
        .hljs-string,
        .hljs-meta .hljs-meta-string,
        .hljs-literal,
        .hljs-doctag,
        .hljs-regexp {
            color: #2aa198;
        }

        /* Solarized Blue */
        .hljs-title,
        .hljs-section,
        .hljs-name,
        .hljs-selector-id,
        .hljs-selector-class {
            color: #268bd2;
        }

        /* Solarized Yellow */
        .hljs-attribute,
        .hljs-attr,
        .hljs-variable,
        .hljs-template-variable,
        .hljs-class .hljs-title,
        .hljs-type {
            color: #b58900;
        }

        /* Solarized Orange */
        .hljs-symbol,
        .hljs-bullet,
        .hljs-subst,
        .hljs-meta,
        .hljs-meta .hljs-keyword,
        .hljs-selector-attr,
        .hljs-selector-pseudo,
        .hljs-link {
            color: #cb4b16;
        }

        /* Solarized Red */
        .hljs-built_in,
        .hljs-deletion {
            color: #dc322f;
        }

        .hljs-formula {
            background: #eee8d5;
        }

        .hljs-emphasis {
            font-style: italic;
        }

        .hljs-strong {
            font-weight: bold;
        }
    </style>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();

        var f = 440;
        var sample_rate = 8000;
        var T = 1.0 / f;
        var sample_duration = 1.0 / sample_rate;
        var intervals = [
            1,
            25. / 24,
            16. / 15,
            9. / 8,
            75. / 64,
            6. / 5,
            5. / 4,
            32. / 25,
            4. / 3,
            25. / 18,
            36. / 25,
            3. / 2,
            25. / 16,
            8. / 5,
            5. / 3,
            125. / 72,
            9. / 5,
            15. / 8,
            48. / 25,
            2
        ];
        var major = [0, 2, 4, 5, 7, 9, 11];
        var minor = [0, 2, 3, 5, 7, 8, 10];

        function base64_encoder(b) {
            // http://tools.ietf.org/html/rfc4648
            var map = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");
            var r = "";
            for (var i = 0; i < b.length; i += 3) {
                var bin = 0x000000;
                // FIXME with one loop
                bin |= b[i] << 16;
                if (i + 1 < b.length)
                    bin |= b[i + 1] << 8;
                if (i + 2 < b.length)
                    bin |= b[i + 2];
                // Converting
                var mask = 0xFC0000;
                for (var j = 0; j < 4; j++) {
                    r += map[((bin & (0xFC0000 >> (j * 6))) >> ((3 - j) * 6))];
                }
            }
            var padding = (b.length % 3 > 0) ? "==".substring(b.length % 3 - 1, 2) : "";
            return r.substring(0, r.length - padding.length) + padding;
        }

        function mk_le_bs(data, size) {
            s = '';
            while (size > 0) {
                s += String.fromCharCode(0xFF & data);
                data >>= 8;
                size--;
            }
            return s;
        }

        function note(scale, n) {
            var nps = scale.length;
            var x = n % nps;

            return   Math.pow(2, (scale[x]+1)/12) * (Math.floor(n / 7) + 1) * f;
        }

        function asdr(attack, delay, sustain, release) {
            return 1;
        }

        function synth(osc, hull, f) {
            return function (t) {
                return Math.floor(127.5 * osc(t, f) * hull(t) + 127.5);
            };
        }

        function sin(x, f) {
            var _const2 = 2.0 * Math.PI * f * sample_duration;
            return Math.sin(x * _const2);
        }


        function play() {

            var t_begin = new Date().getTime();
            var WAVE_FORMAT_PCM = 0x0001;
            var samples_per_period = Math.floor(T * sample_rate);

            var notes = [
                [1, 1]
            ];

            data = [];
            var _const1 = Math.floor(sample_rate * 4);
            var N_samples = 2.0 * Math.PI * f * sample_duration;


            var ns = _const1 / 12;
            for (var idx = 0; idx < _const1; idx++) {
                //data.push(Math.floor(255 * ((Math.sin(2.0 * Math.PI * f * idx * sample_duration) + 1.0) / 2.0)));
                var min = note(minor, Math.floor(idx / ns));
                var maj = note(major, Math.floor(idx / ns) + 2);
                var s1 = synth(sin, asdr, min)(idx);
                var s2 = synth(sin, asdr, maj)(idx);

                data.push(s1 / 4 + s2 / 2);
                //data.push(Math.floor(127.5 * Math.sin(idx * N_samples) + 127.5));
            }

            var s = '';

            pad = (data.length % 2 == 1) ? ' ' : '';
            // http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/WAVE.html
            s = 'RIFF' + mk_le_bs(4 + 24 + (8 + 1 * 1 * data.length + pad.length), 4) +
                'WAVE' + 'fmt ' + mk_le_bs(16, 4) +
                mk_le_bs(WAVE_FORMAT_PCM, 2) +
                mk_le_bs(1, 2) +
                mk_le_bs(sample_rate, 4) +
                mk_le_bs(sample_rate * 1 * 1, 4) +
                mk_le_bs(1 * 1, 2) +
                mk_le_bs(8 * 1, 2) +
                'data' + mk_le_bs(1 * 1 * data.length, 4)
            ;

            bs = [];
            for (var idx = 0; idx < s.length; idx++) {
                bs.push(s.charCodeAt(idx));
            }
            bs = bs.concat(data);
            if (pad.length > 0)
                bs.push(0x00);

            s = 'data:audio/wav;base64,' + base64_encoder(bs);
            var audio = new Audio(s);
            audio.play();
        }
    </script>
</head>
<body>
<h1>
    Woah
</h1>
OH MY GOD HOW DID THIS GET HERE I'M NOT GOOD WITH COMPUTERS
<pre><code class="js">function() {
if (this) c.wl();
}</code></pre>
<button onclick="play()">Play</button>
</body>
</html>